<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Contact Manager - Sequence Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2196f3 0%, #21cbf3 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .content {
            padding: 40px;
        }
        .diagram-section {
            margin-bottom: 50px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            overflow: hidden;
        }
        .diagram-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 20px;
            font-size: 1.5em;
            font-weight: 600;
        }
        .diagram-content {
            padding: 30px;
            background: #f8f9fa;
        }
        .mermaid {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            min-height: 400px;
        }
        .description {
            background: white;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #ff6b6b;
        }
        .description h3 {
            color: #2c3e50;
            margin: 0 0 15px 0;
        }
        .description ul {
            margin: 0;
            padding-left: 20px;
            color: #555;
        }
        .description li {
            margin-bottom: 8px;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #ff6b6b;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        .feature-card h3 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.3em;
        }
        .feature-card ul {
            margin: 0;
            padding-left: 15px;
            color: #555;
        }
        .feature-card li {
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .auth { border-left-color: #3498db; }
        .contact { border-left-color: #2ecc71; }
        .note { border-left-color: #f39c12; }
        .admin { border-left-color: #e74c3c; }
        .message { border-left-color: #9b59b6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Sequence Diagrams</h1>
            <p>Smart Contact Manager - System Interaction Flows</p>
        </div>
        
        <div class="content">
            <!-- User Authentication Flow -->
            <div class="diagram-section">
                <div class="diagram-header">
                    üîê User Authentication Sequence
                </div>
                <div class="diagram-content">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as User
                            participant B as Browser
                            participant AC as AuthController
                            participant US as UserService
                            participant UR as UserRepository
                            participant ES as EmailService
                            participant DB as Database
                            
                            Note over U,DB: User Registration Flow
                            U->>B: Fill registration form
                            B->>AC: POST /register
                            AC->>US: saveUser(userForm)
                            US->>UR: findByEmail(email)
                            UR->>DB: SELECT user by email
                            DB-->>UR: User not found
                            UR-->>US: Optional.empty()
                            US->>US: encodePassword()
                            US->>US: generateEmailToken()
                            US->>UR: save(user)
                            UR->>DB: INSERT new user
                            DB-->>UR: User saved
                            UR-->>US: User entity
                            US->>ES: sendVerificationEmail(user)
                            ES->>ES: Send email via SMTP
                            ES-->>US: Email sent
                            US-->>AC: Registration success
                            AC-->>B: Redirect to verify page
                            B-->>U: Show verification message
                            
                            Note over U,DB: Email Verification Flow
                            U->>B: Click verification link
                            B->>AC: GET /verify?token=xxx
                            AC->>US: verifyEmail(token)
                            US->>UR: findByEmailToken(token)
                            UR->>DB: SELECT user by token
                            DB-->>UR: User found
                            UR-->>US: User entity
                            US->>US: setEmailVerified(true)
                            US->>UR: save(user)
                            UR->>DB: UPDATE user verified
                            DB-->>UR: User updated
                            UR-->>US: Updated user
                            US-->>AC: Verification success
                            AC-->>B: Redirect to login
                            B-->>U: Show success message
                            
                            Note over U,DB: User Login Flow
                            U->>B: Enter credentials
                            B->>AC: POST /login
                            AC->>US: authenticate(email, password)
                            US->>UR: findByEmail(email)
                            UR->>DB: SELECT user by email
                            DB-->>UR: User found
                            UR-->>US: User entity
                            US->>US: checkPassword(password)
                            US->>US: createSession()
                            US-->>AC: Authentication success
                            AC-->>B: Set session cookie
                            B-->>U: Redirect to dashboard
                    </div>
                    
                    <div class="description">
                        <h3>Authentication Flow Overview</h3>
                        <ul>
                            <li><strong>Registration:</strong> User creates account with email verification</li>
                            <li><strong>Verification:</strong> Email token validation and account activation</li>
                            <li><strong>Login:</strong> Credential validation and session creation</li>
                            <li><strong>Security:</strong> Password encryption and token-based verification</li>
                            <li><strong>Email Integration:</strong> SMTP-based email delivery system</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Contact Management Flow -->
            <div class="diagram-section">
                <div class="diagram-header">
                    üìá Contact Management Sequence
                </div>
                <div class="diagram-content">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as User
                            participant B as Browser
                            participant CC as ContactController
                            participant CS as ContactService
                            participant CR as ContactRepository
                            participant IS as ImageService
                            participant Cloud as Cloudinary
                            participant DB as Database
                            
                            Note over U,DB: Add Contact Flow
                            U->>B: Fill contact form
                            B->>CC: POST /contacts/add
                            CC->>CC: validateContactForm()
                            CC->>IS: uploadImage(file)
                            IS->>Cloud: Upload to Cloudinary
                            Cloud-->>IS: Image URL
                            IS-->>CC: Image uploaded
                            CC->>CS: saveContact(contact)
                            CS->>CS: setUser(currentUser)
                            CS->>CR: save(contact)
                            CR->>DB: INSERT contact
                            DB-->>CR: Contact saved
                            CR-->>CS: Contact entity
                            CS-->>CC: Save success
                            CC-->>B: Redirect to contacts
                            B-->>U: Show success message
                            
                            Note over U,DB: View Contacts Flow
                            U->>B: Navigate to contacts
                            B->>CC: GET /contacts
                            CC->>CS: getContactsByUser(user, pageable)
                            CS->>CR: findByUser(user, pageable)
                            CR->>DB: SELECT contacts with pagination
                            DB-->>CR: Contact list
                            CR-->>CS: Page<Contact>
                            CS-->>CC: Contact page
                            CC->>CC: addToModel(contacts)
                            CC-->>B: contacts.html with data
                            B-->>U: Display contact list
                            
                            Note over U,DB: Search Contacts Flow
                            U->>B: Enter search query
                            B->>CC: GET /contacts/search?q=query
                            CC->>CS: searchContacts(query, field, user)
                            CS->>CR: findByUserAndNameContaining(user, query)
                            CR->>DB: SELECT with LIKE clause
                            DB-->>CR: Filtered contacts
                            CR-->>CS: Search results
                            CS-->>CC: Contact results
                            CC-->>B: JSON response
                            B-->>U: Display search results
                            
                            Note over U,DB: Update Contact Flow
                            U->>B: Edit contact form
                            B->>CC: POST /contacts/update/{id}
                            CC->>CS: getContactById(id)
                            CS->>CR: findById(id)
                            CR->>DB: SELECT contact by ID
                            DB-->>CR: Contact found
                            CR-->>CS: Contact entity
                            CS-->>CC: Contact details
                            CC->>CC: validateOwnership(contact, user)
                            CC->>IS: uploadImage(newFile)
                            IS->>Cloud: Upload new image
                            Cloud-->>IS: New image URL
                            IS-->>CC: Image updated
                            CC->>CS: updateContact(contact)
                            CS->>CR: save(updatedContact)
                            CR->>DB: UPDATE contact
                            DB-->>CR: Contact updated
                            CR-->>CS: Updated entity
                            CS-->>CC: Update success
                            CC-->>B: Redirect to contacts
                            B-->>U: Show update success
                    </div>
                    
                    <div class="description">
                        <h3>Contact Management Flow Overview</h3>
                        <ul>
                            <li><strong>Add Contact:</strong> Form validation, image upload, and database storage</li>
                            <li><strong>View Contacts:</strong> Paginated retrieval with user filtering</li>
                            <li><strong>Search Contacts:</strong> Real-time search with multiple field options</li>
                            <li><strong>Update Contact:</strong> Ownership validation and selective updates</li>
                            <li><strong>Image Handling:</strong> Cloudinary integration for file storage</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Note Management Flow -->
            <div class="diagram-section">
                <div class="diagram-header">
                    üìù Note Management Sequence
                </div>
                <div class="diagram-content">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as User
                            participant B as Browser
                            participant NC as NoteController
                            participant NS as NoteService
                            participant NR as NoteRepository
                            participant DB as Database
                            
                            Note over U,DB: Create Note Flow
                            U->>B: Fill note form
                            B->>NC: POST /notes/add
                            NC->>NC: validateNoteForm()
                            NC->>NS: saveNote(noteForm)
                            NS->>NS: createNoteEntity()
                            NS->>NS: setUser(currentUser)
                            NS->>NS: setTimestamps()
                            NS->>NR: save(note)
                            NR->>DB: INSERT note
                            DB-->>NR: Note saved
                            NR-->>NS: Note entity
                            NS-->>NC: Save success
                            NC-->>B: Redirect to notes
                            B-->>U: Show success message
                            
                            Note over U,DB: View Notes with Pagination
                            U->>B: Navigate to notes page
                            B->>NC: GET /notes?page=0&size=10
                            NC->>NS: getNotesByUser(user, pageable)
                            NS->>NR: findByUser(user, pageable)
                            NR->>DB: SELECT with LIMIT/OFFSET
                            DB-->>NR: Note page
                            NR-->>NS: Page<Note>
                            NS-->>NC: Paginated notes
                            NC->>NC: addPaginationAttributes()
                            NC-->>B: notes.html with data
                            B-->>U: Display notes with pagination
                            
                            Note over U,DB: Search Notes by Category
                            U->>B: Select category filter
                            B->>NC: GET /notes?category=work
                            NC->>NS: getNotesByCategory(category, user)
                            NS->>NR: findByUserAndCategory(user, category)
                            NR->>DB: SELECT with category filter
                            DB-->>NR: Filtered notes
                            NR-->>NS: Category notes
                            NS-->>NC: Note results
                            NC-->>B: Filtered view
                            B-->>U: Display category notes
                            
                            Note over U,DB: Toggle Favorite Note
                            U->>B: Click favorite button
                            B->>NC: POST /notes/{id}/favorite
                            NC->>NS: toggleFavorite(noteId, user)
                            NS->>NR: findByIdAndUser(noteId, user)
                            NR->>DB: SELECT note with ownership
                            DB-->>NR: Note found
                            NR-->>NS: Note entity
                            NS->>NS: toggleFavoriteStatus()
                            NS->>NR: save(updatedNote)
                            NR->>DB: UPDATE favorite status
                            DB-->>NR: Note updated
                            NR-->>NS: Updated note
                            NS-->>NC: Toggle success
                            NC-->>B: JSON response
                            B-->>U: Update UI state
                    </div>
                    
                    <div class="description">
                        <h3>Note Management Flow Overview</h3>
                        <ul>
                            <li><strong>Create Note:</strong> Form validation and timestamped storage</li>
                            <li><strong>View Notes:</strong> Paginated display with user filtering</li>
                            <li><strong>Category Filter:</strong> Dynamic filtering by note categories</li>
                            <li><strong>Favorite Toggle:</strong> AJAX-based favorite status updates</li>
                            <li><strong>Ownership Security:</strong> User-specific data access control</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Excel Import/Export Flow -->
            <div class="diagram-section">
                <div class="diagram-header">
                    üìä Excel Import/Export Sequence
                </div>
                <div class="diagram-content">
                    <div class="mermaid">
                        sequenceDiagram
                            participant U as User
                            participant B as Browser
                            participant EC as ExcelController
                            participant ES as ExcelService
                            participant CS as ContactService
                            participant CR as ContactRepository
                            participant DB as Database
                            
                            Note over U,DB: Import Contacts Flow
                            U->>B: Upload Excel file
                            B->>EC: POST /contacts/import
                            EC->>ES: validateExcelFormat(file)
                            ES->>ES: checkFileExtension()
                            ES->>ES: validateHeaders()
                            ES-->>EC: Validation result
                            EC->>ES: importContactsFromExcel(file, user)
                            ES->>ES: parseExcelData()
                            ES->>ES: validateContactData()
                            loop For each valid contact
                                ES->>CS: saveContact(contact)
                                CS->>CR: save(contact)
                                CR->>DB: INSERT contact
                                DB-->>CR: Contact saved
                                CR-->>CS: Success
                                CS-->>ES: Contact created
                            end
                            ES->>ES: generateImportReport()
                            ES-->>EC: Import result
                            EC-->>B: JSON response with stats
                            B-->>U: Show import summary
                            
                            Note over U,DB: Export Contacts Flow
                            U->>B: Click export button
                            B->>EC: GET /contacts/export
                            EC->>CS: getAllContactsByUser(user)
                            CS->>CR: findByUser(user)
                            CR->>DB: SELECT all user contacts
                            DB-->>CR: Contact list
                            CR-->>CS: All contacts
                            CS-->>EC: Contact data
                            EC->>ES: exportContactsToExcel(contacts)
                            ES->>ES: createWorkbook()
                            ES->>ES: addHeaders()
                            loop For each contact
                                ES->>ES: addContactRow()
                            end
                            ES->>ES: generateByteArray()
                            ES-->>EC: Excel byte array
                            EC->>EC: setResponseHeaders()
                            EC-->>B: File download response
                            B-->>U: Download Excel file
                            
                            Note over U,DB: Download Template Flow
                            U->>B: Click download template
                            B->>EC: GET /contacts/template
                            EC->>ES: generateContactTemplate()
                            ES->>ES: createTemplateWorkbook()
                            ES->>ES: addSampleData()
                            ES->>ES: addValidationRules()
                            ES-->>EC: Template byte array
                            EC-->>B: Template download
                            B-->>U: Download template file
                    </div>
                    
                    <div class="description">
                        <h3>Excel Operations Flow Overview</h3>
                        <ul>
                            <li><strong>Import Validation:</strong> File format and data validation before processing</li>
                            <li><strong>Batch Processing:</strong> Efficient handling of multiple contact records</li>
                            <li><strong>Export Generation:</strong> Dynamic Excel file creation with user data</li>
                            <li><strong>Template Download:</strong> Pre-formatted template with validation rules</li>
                            <li><strong>Error Handling:</strong> Comprehensive validation and error reporting</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Admin Management Flow -->
            <div class="diagram-section">
                <div class="diagram-header">
                    üë®‚Äçüíº Admin Management Sequence
                </div>
                <div class="diagram-content">
                    <div class="mermaid">
                        sequenceDiagram
                            participant A as Admin
                            participant B as Browser
                            participant ADC as AdminController
                            participant US as UserService
                            participant CS as ContactService
                            participant SS as SystemService
                            participant UR as UserRepository
                            participant DB as Database
                            
                            Note over A,DB: Admin Dashboard Flow
                            A->>B: Access admin dashboard
                            B->>ADC: GET /admin/dashboard
                            ADC->>US: getTotalUsers()
                            US->>UR: count()
                            UR->>DB: SELECT COUNT(*) from users
                            DB-->>UR: User count
                            UR-->>US: Total users
                            US-->>ADC: User statistics
                            ADC->>CS: getTotalContacts()
                            CS->>CS: getContactStatistics()
                            CS-->>ADC: Contact stats
                            ADC->>SS: getSystemHealth()
                            SS->>SS: checkDatabaseConnection()
                            SS->>SS: checkMemoryUsage()
                            SS-->>ADC: System status
                            ADC-->>B: Dashboard with stats
                            B-->>A: Display admin dashboard
                            
                            Note over A,DB: User Management Flow
                            A->>B: Navigate to user management
                            B->>ADC: GET /admin/users
                            ADC->>US: getAllUsers(pageable)
                            US->>UR: findAll(pageable)
                            UR->>DB: SELECT users with pagination
                            DB-->>UR: User page
                            UR-->>US: Page<User>
                            US-->>ADC: User list
                            ADC-->>B: users.html with data
                            B-->>A: Display user list
                            
                            Note over A,DB: Enable/Disable User Flow
                            A->>B: Click enable/disable button
                            B->>ADC: POST /admin/users/{id}/toggle
                            ADC->>US: toggleUserStatus(userId)
                            US->>UR: findById(userId)
                            UR->>DB: SELECT user by ID
                            DB-->>UR: User found
                            UR-->>US: User entity
                            US->>US: toggleEnabledStatus()
                            US->>UR: save(user)
                            UR->>DB: UPDATE user enabled status
                            DB-->>UR: User updated
                            UR-->>US: Updated user
                            US-->>ADC: Toggle success
                            ADC-->>B: JSON response
                            B-->>A: Update UI status
                            
                            Note over A,DB: System Settings Flow
                            A->>B: Access system settings
                            B->>ADC: GET /admin/settings
                            ADC->>SS: getCurrentSettings()
                            SS->>SS: loadConfigurationProperties()
                            SS-->>ADC: System configuration
                            ADC-->>B: settings.html with config
                            B-->>A: Display settings form
                            A->>B: Update settings
                            B->>ADC: POST /admin/settings
                            ADC->>SS: updateSystemSettings(settings)
                            SS->>SS: validateSettings()
                            SS->>SS: updateConfigurationFiles()
                            SS->>SS: restartServices()
                            SS-->>ADC: Update success
                            ADC-->>B: Redirect to settings
                            B-->>A: Show success message
                    </div>
                    
                    <div class="description">
                        <h3>Admin Management Flow Overview</h3>
                        <ul>
                            <li><strong>Dashboard Analytics:</strong> Real-time system statistics and health monitoring</li>
                            <li><strong>User Management:</strong> Complete user lifecycle administration</li>
                            <li><strong>Status Control:</strong> Dynamic user account enable/disable functionality</li>
                            <li><strong>System Configuration:</strong> Runtime settings management and service control</li>
                            <li><strong>Security Oversight:</strong> Administrative access control and audit logging</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- System Overview -->
            <div class="features-grid">
                <div class="feature-card auth">
                    <h3>üîê Authentication Sequences</h3>
                    <ul>
                        <li>Multi-step registration with email verification</li>
                        <li>Secure password handling and encryption</li>
                        <li>Session management and token validation</li>
                        <li>OAuth integration for social login</li>
                        <li>Password reset and recovery flows</li>
                    </ul>
                </div>
                
                <div class="feature-card contact">
                    <h3>üìá Contact Management Sequences</h3>
                    <ul>
                        <li>CRUD operations with validation</li>
                        <li>Image upload and cloud storage integration</li>
                        <li>Real-time search and filtering</li>
                        <li>Batch operations and bulk updates</li>
                        <li>Data ownership and security controls</li>
                    </ul>
                </div>
                
                <div class="feature-card note">
                    <h3>üìù Note Management Sequences</h3>
                    <ul>
                        <li>Rich text note creation and editing</li>
                        <li>Category-based organization</li>
                        <li>Favorite marking and management</li>
                        <li>Tag-based search and filtering</li>
                        <li>Paginated view with sorting options</li>
                    </ul>
                </div>
                
                <div class="feature-card admin">
                    <h3>üë®‚Äçüíº Admin Management Sequences</h3>
                    <ul>
                        <li>System-wide user administration</li>
                        <li>Real-time statistics and monitoring</li>
                        <li>Configuration management</li>
                        <li>Service control and health checks</li>
                        <li>Security and audit oversight</li>
                    </ul>
                </div>
                
                <div class="feature-card message">
                    <h3>üìä Data Operations Sequences</h3>
                    <ul>
                        <li>Excel import with validation</li>
                        <li>Bulk data processing</li>
                        <li>Export generation and download</li>
                        <li>Template creation and distribution</li>
                        <li>Error handling and reporting</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 30,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                bottomMarginAdj: 1,
                useMaxWidth: true,
                rightAngles: false,
                showSequenceNumbers: false
            }
        });
    </script>
</body>
</html>
